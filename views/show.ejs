
<h1><%= webpage._id %></h1>

<div class="container">

  <!-- load external page internally -->
   <iframe id="internal-webpage" class="internal" type="text/html" src="<%= webpage.url %>" >
   </iframe>


   <div class="appDisplay">

        <h1>Ctrl+F</h1>

        <div class="row">
          <div class="col-md-6">
            <h3>Comments:</h3>
            <ul id="display-comments">
              <% comments.forEach( function(c, i) { %>
                <% if(i<5) { %>
                <li>
                  <%= c.body %>
                </li>
                <% } %>
              <% }) %>
            </ul>
          </div>


            <div class="col-md-6">

            <% if(isLoggedIn) { %>
              <a href="/logout-here" class="btn btn-clear">Logout</a>
               <div>
                  <h3>Add Comment:</h3>
                   <input type="text" id="comment-body"><br/>
                   <button type="button" pageId="<%= webpage._id %>" id="comment-submit">Submit</button>
               </div>

            <% } else { %>



                  <div class=“form-group”>
                      <label>Email</label>
                      <input id="email-here" type=“text” class=“form-control” name=“email”>
                  </div>
                  <div class=“form-group”>
                      <label>Password</label>
                      <input id="password-here" type=“password” class=“form-control” name=“password”>
                  </div>
                  <div class=“text-center”>
                    <a id="login-here" class=“btn btn-default” pageId="<%= webpage._id %>">Login</a>
                </div>


             <hr>

             <p><a href=“/signup”>Sign up</a></p>
              <p>Go back <a href=“/”>home</a>.</p>


            <% } %>




          </div>

</div>

<script type="text/javascript">

  var $displayComments = $('#display-comments')
  var $commentBody = $('#comment-body')
  var $commentSubmit = $('#comment-submit')
  var $loginHere = $('#login-here')
  var $emailHere = $('#email-here')
  var $passwordHere = $('#password-here')

  $loginHere.on('click', function() {
    var pageId = $(this).attr('pageId')
    var requestSettings = {
      method: "POST",
      url: '/login-here',
      data: JSON.stringify({id: $emailHere.val(), password: $passwordHere.val()}),
      contentType: "application.json"
    }
    $.ajax(requestSettings).done(function(u) {
      window.location.replace('/webpages/' + pageId)
    })
  })
  $commentSubmit.on('click', function () {
    var pageId = $(this).attr('pageId');
    console.log("submit button clicked!");

        var requestSettings = {
          method: "POST",
          url: "/webpages/"+ pageId +"/comments",
          data: JSON.stringify({body: $commentBody.val()}),
          contentType: "application/json"
        }

        $.ajax(requestSettings).done(function (c) {
          var theLi = $('<li>')
          theLi.text(c.comment.body)
          $displayComments.append(theLi)
        })


  })

</script>
